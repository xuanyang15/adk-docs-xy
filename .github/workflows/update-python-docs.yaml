# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: Update ADK Python Docs

on:
  issues:
    types: [opened, labeled]

jobs:
  update-adk-python-docs-from-issue:
    if: contains(github.event.issue.labels.*.name, 'docs updates')
    runs-on: ubuntu-latest

    steps:
      - name: Checkout ADK Python repository
        uses: actions/checkout@v4
        with:
          repository: google/adk-python
          path: ./adk-python
          token: ${{ secrets.ADK_BOT_GITHUB_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Authenticate to Google Cloud
        id: auth
        uses: 'google-github-actions/auth@v2'
        with:
          credentials_json: '${{ secrets.ADK_GCP_SA_KEY }}'

      - name: Load adk-bot SSH Private Key
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.ADK_BOT_SSH_PRIVATE_KEY }}

      - name: Set Git Author Identity (for adk-bot)
        run: |
          git config --global user.name "adk-bot"
          git config --global user.email "adk-bot@google.com"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install google-adk

      - name: Run ADK docs updater script
        env:
          GITHUB_TOKEN: ${{ secrets.ADK_BOT_GITHUB_TOKEN }}
          GOOGLE_CLOUD_PROJECT: ${{ secrets.GOOGLE_CLOUD_PROJECT }}
          GOOGLE_CLOUD_LOCATION: ${{ secrets.GOOGLE_CLOUD_LOCATION }}
          GOOGLE_GENAI_USE_VERTEXAI: 1
          DOC_OWNER: 'google'
          DOC_REPO: 'adk-docs'
          CODE_OWNER: 'google'
          CODE_REPO: 'adk-python'
          INTERACTIVE: 0
          PYTHONPATH: adk-python/contributing/samples/adk_documentation
        run:
          python -m adk_docs_updater.main --issue_number ${{ github.event.issue.number }}
